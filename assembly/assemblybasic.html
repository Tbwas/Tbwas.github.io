<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>汇编入门必备 | xindong</title>
    <meta name="description" content="🍎">
    <link rel="icon" href="/resources/favicon.ico">
  <link rel="apple-touch-icon" href="/resources/favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.93490a24.css" as="style"><link rel="preload" href="/assets/js/app.e9db3fe7.js" as="script"><link rel="preload" href="/assets/js/2.45015a89.js" as="script"><link rel="preload" href="/assets/js/8.37f7e56f.js" as="script"><link rel="prefetch" href="/assets/js/10.3fe60ad8.js"><link rel="prefetch" href="/assets/js/11.cd4facc5.js"><link rel="prefetch" href="/assets/js/12.32b4db9e.js"><link rel="prefetch" href="/assets/js/13.a55f585d.js"><link rel="prefetch" href="/assets/js/14.5b5dab30.js"><link rel="prefetch" href="/assets/js/15.2f3cb7d6.js"><link rel="prefetch" href="/assets/js/16.cc0f69f2.js"><link rel="prefetch" href="/assets/js/17.b5f6c5f1.js"><link rel="prefetch" href="/assets/js/18.9793b046.js"><link rel="prefetch" href="/assets/js/19.d40b04a0.js"><link rel="prefetch" href="/assets/js/20.f0fa6039.js"><link rel="prefetch" href="/assets/js/21.bccbb9fb.js"><link rel="prefetch" href="/assets/js/22.6c772d85.js"><link rel="prefetch" href="/assets/js/23.d3a71210.js"><link rel="prefetch" href="/assets/js/24.e8cf9784.js"><link rel="prefetch" href="/assets/js/25.bb524a79.js"><link rel="prefetch" href="/assets/js/26.388b503e.js"><link rel="prefetch" href="/assets/js/27.df0efcee.js"><link rel="prefetch" href="/assets/js/28.df8f6554.js"><link rel="prefetch" href="/assets/js/29.6129bc6c.js"><link rel="prefetch" href="/assets/js/3.1cbc7ba0.js"><link rel="prefetch" href="/assets/js/30.1b1abec7.js"><link rel="prefetch" href="/assets/js/31.6c913de6.js"><link rel="prefetch" href="/assets/js/32.b4fb7248.js"><link rel="prefetch" href="/assets/js/33.cf6426ee.js"><link rel="prefetch" href="/assets/js/34.08cc3265.js"><link rel="prefetch" href="/assets/js/35.6932c268.js"><link rel="prefetch" href="/assets/js/36.44cc8643.js"><link rel="prefetch" href="/assets/js/37.e1cc74b9.js"><link rel="prefetch" href="/assets/js/4.67660188.js"><link rel="prefetch" href="/assets/js/5.bc582d1b.js"><link rel="prefetch" href="/assets/js/6.347f88f8.js"><link rel="prefetch" href="/assets/js/7.6445c2aa.js"><link rel="prefetch" href="/assets/js/9.de5114d7.js">
    <link rel="stylesheet" href="/assets/css/0.styles.93490a24.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">xindong</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/objective-c/" class="nav-link">Objective-C</a></div><div class="nav-item"><a href="/lua/" class="nav-link">Lua</a></div><div class="nav-item"><a href="/java/" class="nav-link">Java</a></div><div class="nav-item"><a href="/assembly/" class="nav-link router-link-active">汇编</a></div><div class="nav-item"><a href="/others/" class="nav-link">其他</a></div><div class="nav-item"><a href="https://github.com/tbwas" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/objective-c/" class="nav-link">Objective-C</a></div><div class="nav-item"><a href="/lua/" class="nav-link">Lua</a></div><div class="nav-item"><a href="/java/" class="nav-link">Java</a></div><div class="nav-item"><a href="/assembly/" class="nav-link router-link-active">汇编</a></div><div class="nav-item"><a href="/others/" class="nav-link">其他</a></div><div class="nav-item"><a href="https://github.com/tbwas" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/assembly/assemblybasic.html" class="active sidebar-link">汇编入门必备</a></li><li><a href="/assembly/assemblyinstructions.html" class="sidebar-link">常见汇编指令</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="汇编入门必备"><a href="#汇编入门必备" aria-hidden="true" class="header-anchor">#</a> 汇编入门必备</h2> <h3 id="字-word"><a href="#字-word" aria-hidden="true" class="header-anchor">#</a> 字(word)</h3> <p>CPU可以处理两种尺寸的数据，即<strong>字</strong>(word)和<strong>字节</strong>(byte)，CPU和内存之间的数据传送单位通常是一个字长。</p> <p>我们知道，1byte = 8bit，那么字长又是多少呢？其实字长通常跟CPU的位数相同。例如：64位CPU字长就是64位，即1word = 8byte，寄存器大小也是64位。但是也有个别情况，比如 Intel 80386CPU是32位的，但字长却是16位，即1word = 2byte，这是为了向后兼容80286CPU(16位)。</p> <h3 id="汇编语言分类"><a href="#汇编语言分类" aria-hidden="true" class="header-anchor">#</a> 汇编语言分类</h3> <p>这里主要介绍最常见的两种CPU架构，即ARM架构和Intel架构。ARM架构主要用户移动设备，比如iOS和Android，而Intel架构主要用于台式电脑。每种CPU架构都有其对应的指令集，于是也就有了不同类型的汇编语言。</p> <p>常见的汇编语言有两种：ARM汇编和x86汇编。而x86汇编按语法格式又分为<a href="https://baike.baidu.com/item/%E8%8B%B1%E7%89%B9%E5%B0%94" target="_blank" rel="noopener noreferrer">Intel汇编<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>和<a href="https://baike.baidu.com/item/AT&amp;T" target="_blank" rel="noopener noreferrer">AT&amp;T汇编<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。Intel和AT&amp;T语法区别见下表：</p> <table><thead><tr><th>项目</th> <th>Intel</th> <th>AT&amp;T</th> <th>说明</th></tr></thead> <tbody><tr><td>寄存器名</td> <td>rax</td> <td>%rax</td> <td>AT&amp;T要在寄存器前加%</td></tr> <tr><td>操作数顺序</td> <td>目标数在前<code>mov rax, rdx</code></td> <td>目标数在后<code>mov %rdx, %rax</code></td> <td>将rdx的值赋给rax</td></tr> <tr><td>立即数</td> <td>原样<code>mov rax, 5</code></td> <td>数字前加$<code>mov $5, %rax</code></td> <td>将5赋给rax</td></tr> <tr><td>十六进制立即数</td> <td>开头加0结尾加H，例如<code>010H</code></td> <td>开头加0x，例如<code>0x10</code></td> <td>十六进制数10</td></tr> <tr><td>访问内存长度表示</td> <td>开头加BYTE PTR, WORD PTR, DWORD PTR和QWORD PTR</td> <td>结尾加b,w,l,q</td> <td>分别表示字节，字，双字和四字</td></tr> <tr><td>引用全局或静态变量var的值</td> <td>[var]</td> <td>var</td> <td>-</td></tr> <tr><td>引用全局或静态变量var的地址</td> <td>var</td> <td>$var</td> <td>-</td></tr> <tr><td>直接寻址/绝对寻址</td> <td>[imm]</td> <td>imm</td> <td>imm表示立即数</td></tr> <tr><td>间接寻址</td> <td>[reg]</td> <td>(%reg)</td> <td>reg表示寄存器</td></tr> <tr><td>基址相对寻址</td> <td>[reg+imm]</td> <td>imm(%reg)</td> <td>-</td></tr> <tr><td>变址寻址</td> <td>[base+index] 或 imm[base+index]</td> <td>(base,index) 或 imm(base+index)</td> <td>base和index均为寄存器</td></tr> <tr><td>比例变址寻址</td> <td>imm[base+index*scale]</td> <td>imm(base, index, scale)</td> <td>scale只能是1, 2, 4, 8其中的一个数字 (1省略不写就是普通变址寻址)</td></tr> <tr><td>代码注释</td> <td>指令和注释用 <strong>;</strong> 分开，例如：<code>mov rax, rdx ;我是注释</code></td> <td>同Intel汇编</td> <td>-</td></tr> <tr><td>所在平台</td> <td>Windows</td> <td>Unix</td> <td>-</td></tr></tbody></table> <p>对于iOS开发来说，iOS真机上的汇编格式为ARM而模拟器上的格式则为AT&amp;T，所以我们重点掌握下这两种汇编即可。ARM汇编的操作数顺序跟Intel是一样的，这里就不详细展开了，具体可以直接看<a href="http://infocenter.arm.com/help/index.jsp" target="_blank" rel="noopener noreferrer">官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h3 id="寻址方式"><a href="#寻址方式" aria-hidden="true" class="header-anchor">#</a> 寻址方式</h3> <p>顾名思义，寻址方式就是CPU根据指令中给出的地址信息来寻找有效地址的方式，是确定本条指令的数据地址以及下一条要执行的指令地址的方法。寻址方式分为两类，即<strong>指令寻址方式</strong>和<strong>数据寻址方式</strong>。</p> <h4 id="_0x1-指令寻址方式："><a href="#_0x1-指令寻址方式：" aria-hidden="true" class="header-anchor">#</a> 0x1. 指令寻址方式：</h4> <p>指令地址在内存中是按顺序安排的，当执行一段程序时，通常是一条指令接着一条指令地顺序进行。也就是说，从内存中取出第一条指令，然后执行；接着从内存中再取出第二条指令，继续执行；依次类推。这种顺序执行的过程，称为<strong>顺序寻址方式</strong>。为此，必须使用程序计数器PC（ARM下叫PC，x86下叫IP）来计数指令的地址(<strong>Tip1</strong>)。</p> <p>当程序转移执行的顺序时，指令的寻址就采取<strong>跳跃寻址方式</strong>。所谓跳跃，就是下条指令的地址不再由PC给出，而是由本条指令给出。跳跃后，按新的指令地址开始顺序执行。因此，PC的内容也必须改变，以便能及时跟踪新的指令地址。</p> <div class="tip custom-block"><p>Tip1: 当执行一条指令时，首先需要根据PC中存放的指令地址，将指令由内存取到指令寄存器中，与此同时，PC中的地址或自动加1或由转移指针给出下一条指令的地址。</p></div> <h4 id="_0x2-数据寻址方式："><a href="#_0x2-数据寻址方式：" aria-hidden="true" class="header-anchor">#</a> 0x2. 数据寻址方式：</h4> <p>数据寻址方式比较多，这里只列出几种常见的寻址方式，基本上都是汇编语言里经常用到的。</p> <p><strong>0x21. 立即寻址:</strong></p> <p>指令的地址字段给出的不是操作数的地址，而是操作数本身，由于不需要访问内存取数，所以指令执行时间很短(Note1)。例如：<code>mov 0x123, %rax</code></p> <div class="warning custom-block"><p>Note1:
立即数只能作为源操作数，而不能作为目的操作数。</p></div> <p><strong>0x22. 直接寻址:</strong></p> <p>指令的地址字段给出的是操作数的内存地址。因为直接给出操作数的内存地址而不需要经过某种变换，所以称为直接寻址。</p> <p><strong>0x23. 间接寻址:</strong></p> <p>间接寻址是相对直接寻址而言的，在间接寻址的情况下，指令地址字段给出的地址，是个形式地址不是操作数的真正地址，或者说该地址单元中的内容才是操作数的有效地址。</p> <p><strong>0x24. 相对寻址:</strong></p> <p>相对寻址是把PC的内容加上指令格式中的形式地址D而形成操作数的有效地址。&quot;相对&quot;寻址，就是相对于当前的指令地址而言，好处是程序员无须用指令的绝对地址编程，因而所编程序可以放在内存的任何地方。</p> <p><strong>0x25. 基址寻址:</strong></p> <p>在基址寻址方式中将CPU中的基址寄存器的内容，加上变址寄存器的内容而形成操作数的有效地址。基址寻址的优点是可以扩大寻址能力。</p> <p><strong>0x26. 变址寻址:</strong></p> <p>把CPU中某个变址寄存器的内容与偏移量D相加来形成操作数有效地址。参见上表👆</p> <p><strong>0x27. 寄存器寻址:</strong></p> <p>操作数不放在内存中，而是把操作数本身的值放在CPU的通用寄存器中。</p> <p><strong>0x28. 寄存器间接寻址:</strong></p> <p>把操作数地址放在CPU的通用寄存器中，而操作数本身的值则放在内存中。</p> <hr> <p><strong>参考资料:</strong></p> <p><a href="https://css.csail.mit.edu/6.858/2014/readings/i386/s02_03.htm" target="_blank" rel="noopener noreferrer">https://Intel 80386 Reference Programmer's Manual<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <a href="https://zh.wikipedia.org/wiki/%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80" target="_blank" rel="noopener noreferrer">https://en.wikipedia.org/wiki/Assembly_language<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <a href="https://baike.baidu.com/item/%E5%AF%BB%E5%9D%80%E6%96%B9%E5%BC%8F" target="_blank" rel="noopener noreferrer">https://baike.baidu.com/item/%E5%AF%BB%E5%9D%80%E6%96%B9%E5%BC%8F<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新: </span> <span class="time">10/16/2019, 8:29:31 PM</span></div></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/assembly/assemblyinstructions.html">
          常见汇编指令
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.e9db3fe7.js" defer></script><script src="/assets/js/2.45015a89.js" defer></script><script src="/assets/js/8.37f7e56f.js" defer></script>
  </body>
</html>
